<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="facet.css">
    <script src="lib/underscore.js"></script>
    <script src="lib/async.js"></script>
    <script src="lib/d3.js"></script>
    <script src="lib/jquery-1.9.1.js"></script>
    <script src="facet.js"></script>
    <script src="driverUtil.js"></script>
    <script src="simpleDriver.js"></script>
    <script src="sqlDriver.js"></script>
    <script src="druidDriver.js"></script>

    <title>Facet Examples (0.0.4)</title>

    <script>
      // The basics
      var split = facet.split;
      var apply = facet.apply;
      var layout = facet.layout;
      var scale = facet.scale;
      var plot = facet.plot;
      var use = facet.use;
      var sort = facet.sort;
      var stage = facet.stage;
    </script>
  </head>

  <body>
    <div class="cont">
      <h1>Avg Price by Cut by Clarity</h1>
      <h2>SQL Driver in Client / diamonds</h2>
      <div class="example"></div>
    </div>
    <script>
    (function() {
      // {
      //   "carat": "0.23",
      //   "cut": "Ideal",
      //   "color": "E",
      //   "clarity": "SI2",
      //   "depth": "61.5",
      //   "table": "55",
      //   "price": "326",
      //   "x": "3.95",
      //   "y": "3.98",
      //   "z": "2.43"
      // },

      var sqlRequester = facet.ajaxPoster({
        url: '/pass/sql',
        prety: true
      });

      var sqlDriverClient = sqlDriver({
        requester: sqlRequester,
        table: "diamonds",
        filters: null
      });

      var vis = facet.define('.example', 800, 600, sqlDriverClient)
        .split('Clarity', split.identity('clarity'))
        .apply('AvgPrice', apply.average('price'))
        .combine({ sort: { prop: 'AvgPrice', direction: 'descending' }})
        .layout(layout.horizontal({ gap: 3 }))
        .plot(plot.rect({
          fill: use.literal('none'),
          stroke: use.literal('black')
        }))
        .stage(stage.rectToPoint({ top: 6 }))
          .plot(plot.text({
            text: use.prop('Clarity'),
            anchor: use.literal('middle'),
            baseline: use.literal('top')
          }))
        .unstage()
          .split('Cut', split.identity('cut'))
          .apply('AvgPrice', apply.average('price'))
          .combine({ sort: { prop: 'AvgPrice', direction: 'descending' }})
          .layout(layout.horizontal({ gap: 3 }))
          .scale('vert', 2, scale.linear({include: 0, domain: use.prop('AvgPrice'), range: 'height'}))
          .plot(plot.rect({
            fill: use.literal('#f0f0f0'),
            stroke: use.scale.color('Cut'),
            bottom: use.literal(0),
            height: use.scaled('vert', use.prop('AvgPrice'))
          }))
          .stage(stage.rectToPoint({ bottom: 6 }))
            .plot(plot.text({
              text: use.prop('Cut'),
              color: use.scale.color('Cut'),
              baseline: use.literal('center'),
              angle: use.literal(-90)
            }))
          .unstage()
          .render()
    })();
    </script>
  </body>
</html>
