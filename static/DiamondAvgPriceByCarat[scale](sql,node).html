<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="facet.css">
    <script src="lib/underscore.js"></script>
    <script src="lib/async.js"></script>
    <script src="lib/d3.v3.js"></script>
    <script src="lib/jquery-1.9.1.js"></script>
    <script src="facet.js"></script>
    <script src="driverUtil.js"></script>
    <script src="simpleDriver.js"></script>
    <script src="sqlDriver.js"></script>
    <script src="druidDriver.js"></script>

    <title>Facet Examples (0.2.1)</title>

    <script>
      // The basics
      var filter = facet.filter;
      var split = facet.split;
      var apply = facet.apply;
      var layout = facet.layout;
      var scale = facet.scale;
      var plot = facet.plot;
      var use = facet.use;
      var combine = facet.combine;
      var sort = facet.sort;
      var transform = facet.transform;
    </script>
  </head>

  <body>

    <div class="cont">
      <h1>Diamond Avg Price by Cut</h1>
      <h2>SQL Driver in Client / diamonds</h2>
      <div class="example"></div>
    </div>
    <script>
    (function() {
      // {
      //   "carat": "0.23",
      //   "cut": "Ideal",
      //   "color": "E",
      //   "clarity": "SI2",
      //   "depth": "61.5",
      //   "table": "55",
      //   "price": "326",
      //   "x": "3.95",
      //   "y": "3.98",
      //   "z": "2.43"
      // },

      var sqlRequester = facet.ajaxPoster({
        url: '/pass/sql',
        prety: true
      });

      var sqlDriverClient = sqlDriver({
        requester: sqlRequester,
        table: "diamonds",
        filter: null
      });

      function intervalToString(int) {
        return int.start.toFixed(1) + ' - ' + int.end.toFixed(1)
      }

      facet.define('.example', 800, 600, sqlDriverClient)
        .transform(transform.rectangle.rectangle({left: 10, right: 10, top: 10, bottom: 10}))
        .scale('horiz', scale.linear())
        .range('horiz', use.stage('width'))
        .scale('vert', scale.linear())
          .split('Carat', split.continuous('carat', 0.1))
          .apply('Count', apply.count())
          .apply('AvgPrice', apply.average('price'))
          .combine(combine.slice(sort.natural('Carat', 'ascending')))
          .domain('horiz', use.prop('Carat'))
          .domain('vert', use.interval(0, use.prop('AvgPrice')))
          .layout(layout.horizontalScale({ scale: 'horiz' }))
          .range('vert', use.stage('height'))
          .transform(transform.rectangle.rectangle({
            bottom: 0,
            height: use.scale('vert')
          }))
            .plot(plot.box({
              fill: '#f0f0f0',
              stroke: 'black'
            }))
            .transform(transform.rectangle.point({ bottom: 6 }))
              .plot(plot.label({
                text: use.fn(use.prop('Carat'), intervalToString),
                baseline: 'center',
                angle: 90
              }))
            .untransform()
            .transform(transform.rectangle.point({ top: 0 }))
              .plot(plot.circle({
                color: 'red',
                radius: 3
              }))
              .plot(plot.label({
                baseline: 'bottom',
                anchor: 'middle',
                size: 10,
                text: use.prop('Count')
              }))
              .render()
    })();
    </script>
  </body>
</html>
