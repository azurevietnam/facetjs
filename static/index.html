<!DOCTYPE html>
<html>
  <head>
    <!--
    Forgive me but this is a prototype :-)
    -->
    <link rel="stylesheet/less" type="text/css" href="facet.less">
    <script src="lib/less-1.3.0.min.js"></script>
    <script src="http://underscorejs.org/underscore-min.js"></script>
    <script src="lib/d3.js"></script>
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="facet.js"></script>
    <script src="simple.js"></script>
    <script src="sql.js"></script>
    <script src="druid.js"></script>
    <title>Facet v0.2</title>
  </head>

  <body>
    <div class="cont">
    </div>
    <script>
      window.data1 = (function() {
        var now, pick, w;
        pick = function(arr) {
          return arr[Math.floor(Math.random() * arr.length)];
        };
        now = Date.now();
        w = 100;
        return d3.range(400).map(function(i) {
          return {
            id: i,
            time: new Date(now + i * 13 * 1000),
            letter: 'ABC'[Math.floor(3 * i / 400)],
            number: pick([1, 10, 3, 4]),
            scoreA: i * Math.random() * Math.random(),
            scoreB: 10 * Math.random(),
            walk: w += Math.random() - 0.5 + 0.02
          };
        });
      })();

      // var query = [
      //   { operation: 'apply', prop: 'SumScoreA', aggregate: 'sum', attribute: 'scoreA' },
      //   { operation: 'split', prop: 'Letter', bucket: 'natural', attribute: 'letter' },
      //   { operation: 'apply', prop: 'SumScoreA', aggregate: 'sum', attribute: 'scoreA' }
      // ];
      // var simpleDriver = facet.driver.simple(data1);
      // simpleDriver(query, function(err, res) {
      //   if (err) {
      //     console.log("ERROR");
      //     throw err;
      //   }

      //   console.log(res);
      // });

      var split = facet.split;
      var apply = facet.apply;
      var layout = facet.layout;
      var plot = facet.plot;
      var prop = facet.prop;
      var sort = facet.sort;
      var stage = facet.stage;

      //var driver = simpleDriver;
      var driver = facet.ajaxPostDriver({
        url: '/driver/simple',
        context: { data: 'data1' },
        prety: true
      });

      var rect1 = facet.visualize(driver)
        .split('Letter', split.natural('letter'))
        .apply('avgScoreA', apply.average('scoreA'))
        .layout(layout.vertical({ size: prop('avgScoreA'), gap: 5 }))
        .plot(plot.rect({ color: 'none' }))
        .stage(stage.rectToPoint(0.5, 0.5)).plot(plot.text({ text: prop('Letter'), color: 'green' })).pop()
        .render('.cont', 800, 600)
          // .split('Time', split.time('time', 'minute'))
          // .layout(layout.horizontal({ gap: 2 }))
          // .plot(plot.rect({ color: '#ccccff' }))
          // .stage(stage.rectToPoint(0.5, 0.5)).plot(plot.text({ text: prop('Number'), color: 'red' })).pop()
          // .render('.cont', 800, 600)


      // facet.ajaxPostDriver({
      //   url: '/driver/simple',
      //   context: { data: 'data1' },
      //   prety: true
      // })([
      //   { operation: 'apply', prop: 'SumScoreA', aggregate: 'sum', attribute: 'scoreA' },
      //   { operation: 'split', prop: 'Letter', bucket: 'natural', attribute: 'letter' },
      //   { operation: 'apply', prop: 'SumScoreA', aggregate: 'sum', attribute: 'scoreA' }
      // ])
    </script>
  </body>
</html>
