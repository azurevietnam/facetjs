<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="facet.css">
    <script src="lib/underscore.js"></script>
    <script src="lib/async.js"></script>
    <script src="lib/d3.v3.js"></script>
    <script src="lib/jquery-1.9.1.js"></script>
    <script src="facet.js"></script>
    <script src="driverUtil.js"></script>
    <script src="simpleDriver.js"></script>
    <script src="sqlDriver.js"></script>
    <script src="druidDriver.js"></script>

    <title>Facet Examples (0.2.1)</title>

    <script>
      // The basics
      var split = facet.split;
      var apply = facet.apply;
      var layout = facet.layout;
      var scale = facet.scale;
      var plot = facet.plot;
      var use = facet.use;
      var sort = facet.sort;
      var transform = facet.transform;
    </script>
  </head>

  <body>

    <div class="cont">
      <h1>Wiki Added Vs Deleted Page</h1>
      <h2>SQL Driver in Client / wikipedia</h2>
      <div class="example"></div>
    </div>
    <script>
    (function() {
      // dimensions
      // ["dma_code","continent_code","geo","area_code","robot","country_name","network","city","namespace","anonymous","unpatrolled","page","postal_code","language","newpage","user","region_lookup"]
      // metrics
      // ["count","added","variation","delta","delta_hist","unique_users","deleted"]}

      var sqlRequester = facet.ajaxPoster({
        url: '/pass/sql',
        prety: true
      });

      var sqlDriverClient = sqlDriver({
        requester: sqlRequester,
        table: "wiki",
        filters: null
      });

      function formatEditsAndPage(edits, page) {
        var str = '(' + edits + ') ' + page;
        var lim = 40;
        if (str.length > lim) {
          str = str.substring(0, lim) + '...';
        }
        return str;
      }

      facet.define('.example', 800, 600, sqlDriverClient)
        .scale('horiz', scale.linear())
        .scale('vert',  scale.linear())
          .split('Page', split.identity('page'))
          .apply('Edits', apply.count())
          .apply('Added', apply.sum('added'))
          .apply('Deleted', apply.sum('deleted'))
          .combine({ sort: { prop: 'Edits', direction: 'descending' }, limit: 50})
          .plot(plot.box({
            fill: 'none',
            stroke: 'black'
          }))
          .domain('horiz', use.prop('Added'))
          .domain('vert', use.prop('Deleted'))
          .range('horiz', use.stage('width'))
          .range('vert', use.stage('height'))
          .transform(transform.rectangle.point({ top: use.scale('horiz'), left: use.scale('vert') }))
            .plot(plot.circle({
              radius: 5,
              fill: 'none',
              stroke: 'black',
            }))
          .untransform()
          .render()

    })();
    </script>
  </body>
</html>
